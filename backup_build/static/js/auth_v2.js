const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);async function syncData(e){try{const{data:t,error:a}=await supabase.from("Bedrijven").select("*");if(a)throw a;const s=t.map(e=>({id:e.id,companyName:e.company_name,contactPerson:e.contact_person||"Onbekend",email:e.email,address:e.address||"",accessCode:e.access_code}));localStorage.setItem("sc_employers",JSON.stringify(s));const r=t.find(t=>t.email&&t.email.toLowerCase()===e);r&&localStorage.setItem("sc_selected_employer",r.id);const{data:n,error:o}=await supabase.from("Students").select("*");if(o)throw o;const i=n.map(e=>({id:e.name,name:e.name,studentNumber:e.student_number,companyId:e.company_id,level:e.level,startDate:e.start_date,endDate:e.end_date}));localStorage.setItem("sc_students",JSON.stringify(i));const c=i.map((e,t)=>({id:`int_${Date.now()}_${t}`,studentId:e.name,employerId:e.companyId,supervisorId:"sup1",startDate:e.startDate||"2025-02-01",endDate:e.endDate||"2025-07-31",scheduledDays:["Ma","Di","Wo","Do","Vr"]}));localStorage.setItem("sc_internships",JSON.stringify(c))}catch(e){console.error("Fout bij data sync:",e)}}async function saveAttendanceToSupabase(e){try{const{data:t,error:a}=await supabase.from("Attendance").insert([{student_id:e.studentId,employer_id:e.employerId,date:e.date,status:e.status,minutes_late:e.minutesLate||0}]);return a?{success:!1,error:a}:{success:!0,data:t}}catch(e){return{success:!1,error:e}}}window.saveAttendanceToSupabase=saveAttendanceToSupabase;async function ensureTestCompany(){await supabase.from("Bedrijven").upsert({id:"2e34ea56-7700-4db6-a62f-4d6676d0b93e",company_name:"Test Bedrijf",access_code:"9999",email:"test@bedrijf.nl"},{onConflict:"id"})}ensureTestCompany();const loginForm=document.getElementById("login-form"),errorMessage=document.getElementById("error-message");loginForm&&loginForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value,a=document.getElementById("password").value;errorMessage.classList.add("hidden");try{const{data:e,error:s}=await supabase.auth.signInWithPassword({email:t,password:a});if(s)throw s;localStorage.setItem("stageconnect_session","true"),localStorage.setItem("user_email",t),await syncData(t),window.location.href="index.html"}catch(e){errorMessage.textContent="Inloggen mislukt. Controleer je gegevens.",errorMessage.classList.remove("hidden")}});