const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);let allAttendance=[],companies=[],students=[];async function init(){await Promise.all([loadCompanies(),loadStudents(),loadAttendance()]),setupRealtimeSubscription(),setupFilters(),updateDashboard()}async function loadCompanies(){const{data:e}=await supabase.from("Bedrijven").select("*");companies=e||[];const t=document.getElementById("filter-company");companies.forEach(e=>{t.innerHTML+= `<option value="${e.id}">${e.company_name}</option>`})}async function loadStudents(){const{data:e}=await supabase.from("Students").select("*");students=e||[]}async function loadAttendance(){const{data:e,error:t}=await supabase.from("Attendance").select("*").order("date",{ascending:!1});t&&console.error("Error loading attendance:",t),allAttendance=e||[]}function setupRealtimeSubscription(){supabase.channel("public:Attendance").on("postgres_changes",{event:"*",schema:"public",table:"Attendance"},e=>{console.log("Real-time update:",e),loadAttendance().then(updateDashboard)}).subscribe()}function setupFilters(){["filter-date","filter-company","filter-status"].forEach(e=>{document.getElementById(e).addEventListener("change",updateDashboard)}),document.getElementById("filter-date").valueAsDate=new Date}function updateDashboard(){const e=document.getElementById("filter-date").value,t=document.getElementById("filter-company").value,n=document.getElementById("filter-status").value;let s=allAttendance;e&&(s=s.filter(t=>t.date===e)),t&&(s=s.filter(e=>e.employer_id===t)),n&&(s=s.filter(e=>e.status===n)),updateStats(s),renderTable(s)}function updateStats(e){const t={present:e.filter(e=>"present"===e.status).length,absent:e.filter(e=>"absent"===e.status).length,sick:e.filter(e=>"sick"===e.status).length,late:e.filter(e=>"late"===e.status).length};document.getElementById("stat-present").textContent=t.present,document.getElementById("stat-absent").textContent=t.absent,document.getElementById("stat-sick").textContent=t.sick,document.getElementById("stat-late").textContent=t.late}function renderTable(e){const t=document.getElementById("attendance-table-body");t.innerHTML="",e.forEach(e=>{const n=students.find(t=>t.name===e.student_id)||{name:e.student_id},s=companies.find(t=>t.id===e.employer_id)||{company_name:"Onbekend"},a={present:"bg-green-100 text-green-800",absent:"bg-red-100 text-red-800",sick:"bg-orange-100 text-orange-800",late:"bg-yellow-100 text-yellow-800"},o={present:"Aanwezig",absent:"Afwezig",sick:"Ziek",late:`Te laat (${e.minutes_late}m)`},r=`<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${n.name}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${s.company_name}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${e.date}</td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a[e.status]}">${o[e.status]}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${"late"===e.status?`${e.minutes_late} minuten`:"-"}</td></tr>`;t.innerHTML+=r})}init();