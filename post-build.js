const fs = require('fs');
const path = require('path');
console.log('üîß Post-build gestart...');
// Read Supabase config from environment to avoid hardcoded secrets in repo
const SUPABASE_URL = process.env.SUPABASE_URL || '';
const SUPABASE_KEY = process.env.SUPABASE_ANON_KEY || '';
if (!SUPABASE_URL || !SUPABASE_KEY) {
    console.warn('‚ö†Ô∏è  Warning: SUPABASE_URL or SUPABASE_ANON_KEY not set. Generated files will contain empty values.');
}
// If repository still contains the old hardcoded values, we'll replace them when writing files.
const _HARDCODED_SUPABASE_URL = 'https://ninkkvffhvkxrrxddgrz.supabase.co';
const _HARDCODED_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';
function injectSupabaseVars(str) {
    if (typeof str !== 'string') return str;
    return str.split(_HARDCODED_SUPABASE_URL).join(SUPABASE_URL).split(_HARDCODED_SUPABASE_KEY).join(SUPABASE_KEY);
}
const buildDir = path.join(__dirname, 'build');
const staticJs = path.join(buildDir, 'static', 'js');
if (!fs.existsSync(staticJs)) {
    fs.mkdirSync(staticJs, { recursive: true });
}
// 1. HTML Bestanden
console.log('Herstellen HTML bestanden...');
const loginHtml = `<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Login - Stage Connectie App</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body { font-family: 'Inter', sans-serif; }</style></head><body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-gray-800 mb-2">Stage Connectie App</h1><p class="text-gray-600">Groene Hart Pro College</p></div><form id="login-form" class="space-y-6"><div><label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label><input type="email" id="email" required placeholder="naam@bedrijf.nl" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"></div><div><label for="password" class="block text-sm font-medium text-gray-700 mb-2">Wachtwoord</label><input type="password" id="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"></div><div id="error-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm"></div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-lg hover:shadow-xl">Inloggen</button></form><div class="mt-6 text-center"><a href="admin-login.html" class="text-sm text-blue-600 hover:text-blue-700">School medewerker? Klik hier ‚Üí</a></div></div><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="./static/js/auth_v2.js"></script></body></html>`;
fs.writeFileSync(path.join(buildDir, 'login.html'), injectSupabaseVars(loginHtml));
const adminLoginHtml = `<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Admin Login - Stage Connectie App</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body { font-family: 'Inter', sans-serif; }</style></head><body class="bg-gray-100 min-h-screen flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md"><div class="text-center mb-8"><h1 class="text-2xl font-bold text-gray-800">Admin Portal</h1><p class="text-gray-600">Alleen voor schoolmedewerkers</p></div><form id="admin-login-form" class="space-y-6"><div><label class="block text-sm font-medium text-gray-700 mb-2">Email</label><input type="email" id="admin-email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"></div><div><label class="block text-sm font-medium text-gray-700 mb-2">Wachtwoord</label><input type="password" id="admin-password" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"></div><div id="login-error" class="hidden text-red-600 text-sm text-center"></div><button type="submit" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-semibold py-3 rounded-lg transition">Inloggen</button></form><div class="mt-6 text-center"><a href="login.html" class="text-sm text-blue-600 hover:text-blue-700">‚Üê Terug naar werkgever login</a></div></div><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="./static/js/admin-auth.js"></script></body></html>`;
fs.writeFileSync(path.join(buildDir, 'admin-login.html'), injectSupabaseVars(adminLoginHtml));
const adminHtml = `<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Admin Portal - Stage Connectie App</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body { font-family: 'Inter', sans-serif; }</style><script>if (!localStorage.getItem('stageconnect_admin_session')) { window.location.href = 'admin-login.html'; }</script></head><body class="bg-gray-50"><header class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><div><h1 class="text-2xl font-bold text-gray-800">Admin Portal</h1><p class="text-sm text-gray-600">Groene Hart Pro College</p></div><div class="flex gap-4"><a href="admin-students.html" class="px-4 py-2 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg transition font-medium">Studenten Beheer</a><a href="admin-companies.html" class="px-4 py-2 bg-purple-50 text-purple-600 hover:bg-purple-100 rounded-lg transition font-medium">Bedrijven Beheer</a><button onclick="logout()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition">Uitloggen</button></div></div></header><main class="max-w-7xl mx-auto px-4 py-8"><div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"><div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h3 class="text-gray-500 text-sm font-medium">Aanwezig Vandaag</h3><p class="text-3xl font-bold text-green-600 mt-2" id="stat-present">-</p></div><div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h3 class="text-gray-500 text-sm font-medium">Afwezig</h3><p class="text-3xl font-bold text-red-600 mt-2" id="stat-absent">-</p></div><div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h3 class="text-gray-500 text-sm font-medium">Ziek</h3><p class="text-3xl font-bold text-orange-500 mt-2" id="stat-sick">-</p></div><div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h3 class="text-gray-500 text-sm font-medium">Te Laat</h3><p class="text-3xl font-bold text-yellow-500 mt-2" id="stat-late">-</p></div></div><div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap gap-4 items-end"><div><label class="block text-sm font-medium text-gray-700 mb-1">Datum</label><input type="date" id="filter-date" class="px-3 py-2 border rounded-lg text-sm"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Bedrijf</label><select id="filter-company" class="px-3 py-2 border rounded-lg text-sm min-w-[200px]"><option value="">Alle bedrijven</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Status</label><select id="filter-status" class="px-3 py-2 border rounded-lg text-sm"><option value="">Alle status</option><option value="present">Aanwezig</option><option value="absent">Afwezig</option><option value="sick">Ziek</option><option value="late">Te laat</option></select></div></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bedrijf</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Datum</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th></tr></thead><tbody id="attendance-table-body" class="divide-y divide-gray-200"></tbody></table></div></main><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="./static/js/admin-auth.js"></script><script src="./static/js/admin.js"></script></body></html>`;
fs.writeFileSync(path.join(buildDir, 'admin.html'), injectSupabaseVars(adminHtml));
const adminStudentsHtml = `<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Studenten Beheer - Stage Connectie App</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body { font-family: 'Inter', sans-serif; }</style><script>if (!localStorage.getItem('stageconnect_admin_session')) { window.location.href = 'admin-login.html'; }</script></head><body class="bg-gray-50"><header class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><div class="flex items-center gap-4"><a href="admin.html" class="text-gray-500 hover:text-gray-700">‚Üê Terug</a><div><h1 class="text-2xl font-bold text-gray-800">Studenten Beheer</h1><p class="text-sm text-gray-600">Beheer studenten en stagedagen</p></div></div><button onclick="logout()" class="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition">Uitloggen</button></div></header><main class="max-w-7xl mx-auto px-4 py-8"><div class="mb-6 flex justify-end"><button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>Nieuwe Student</button></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Naam</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Studentnummer</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bedrijf</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stagedagen</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Acties</th></tr></thead><tbody id="students-table-body" class="divide-y divide-gray-200"></tbody></table></div></main><div id="student-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6"><h2 id="modal-title" class="text-xl font-bold mb-4">Student Toevoegen</h2><form id="student-form" class="space-y-4"><input type="hidden" id="student-id"><div><label class="block text-sm font-medium text-gray-700 mb-1">Naam</label><input type="text" id="name" required class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Studentnummer</label><input type="text" id="student_number" required class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Bedrijf</label><select id="company_id" class="w-full px-3 py-2 border rounded-lg"><option value="">Geen bedrijf</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-2">Stagedagen</label><div class="flex gap-3"><label class="flex items-center gap-1"><input type="checkbox" name="days" value="Ma"> Ma</label><label class="flex items-center gap-1"><input type="checkbox" name="days" value="Di"> Di</label><label class="flex items-center gap-1"><input type="checkbox" name="days" value="Wo"> Wo</label><label class="flex items-center gap-1"><input type="checkbox" name="days" value="Do"> Do</label><label class="flex items-center gap-1"><input type="checkbox" name="days" value="Vr"> Vr</label></div></div><div class="flex justify-end gap-3 mt-6"><button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Annuleren</button><button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Opslaan</button></div></form></div></div><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script>const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);let companies=[];async function loadData(){const{data:e}=await supabase.from("Bedrijven").select("*");companies=e||[];const t=document.getElementById("company_id");t.innerHTML='<option value="">Geen bedrijf</option>',companies.forEach(e=>{t.innerHTML+= \`<option value="\${e.id}">\${e.company_name}</option>\`});const{data:a,error:n}=await supabase.from("Students").select("*").order("name");n&&console.error(n);const o=document.getElementById("students-table-body");o.innerHTML="",a.forEach(e=>{const t=companies.find(t=>t.id===e.company_id)?.company_name||"-",a=(e.scheduled_days||[]).join(", ");o.innerHTML+= \`<tr class="hover:bg-gray-50"><td class="px-6 py-4 text-sm font-medium text-gray-900">\${e.name}</td><td class="px-6 py-4 text-sm text-gray-500">\${e.student_number||"-"}</td><td class="px-6 py-4 text-sm text-gray-500">\${t}</td><td class="px-6 py-4 text-sm text-gray-500">\${a}</td><td class="px-6 py-4 text-right text-sm font-medium"><button onclick='editStudent(\${JSON.stringify(e)})' class="text-blue-600 hover:text-blue-900 mr-3">Bewerk</button><button onclick="deleteStudent('\${e.id}')" class="text-red-600 hover:text-red-900">Verwijder</button></td></tr>\`})}function openModal(e=null){const t=document.getElementById("student-modal"),a=document.getElementById("modal-title"),n=document.getElementById("student-form");t.classList.remove("hidden"),e?(a.textContent="Student Bewerken",document.getElementById("student-id").value=e.id,document.getElementById("name").value=e.name,document.getElementById("student_number").value=e.student_number||"",document.getElementById("company_id").value=e.company_id||"",(e.scheduled_days||[]).forEach(e=>{const t=document.querySelector(\`input[name="days"][value="\${e}"]\`);t&&(t.checked=!0)})):(a.textContent="Student Toevoegen",n.reset(),document.getElementById("student-id").value="")}function closeModal(){document.getElementById("student-modal").classList.add("hidden")}window.editStudent=function(e){openModal(e)},window.deleteStudent=async function(e){if(confirm("Weet je zeker dat je deze student wilt verwijderen?")){const{error:t}=await supabase.from("Students").delete().eq("id",e);t?alert("Fout bij verwijderen: "+t.message):loadData()}},document.getElementById("student-form").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("student-id").value,a=document.getElementById("name").value,n=document.getElementById("student_number").value,o=document.getElementById("company_id").value||null,s=Array.from(document.querySelectorAll('input[name="days"]:checked')).map(e=>e.value),r={name:a,student_number:n,company_id:o,scheduled_days:s};let d;if(t){const{error:e}=await supabase.from("Students").update(r).eq("id",t);d=e}else{const{error:e}=await supabase.from("Students").insert([r]);d=e}d?alert("Fout bij opslaan: "+d.message):(closeModal(),loadData())});function logout(){localStorage.removeItem("stageconnect_admin_session"),window.location.href="admin-login.html"}loadData();</script></body></html>`;
fs.writeFileSync(path.join(buildDir, 'admin-students.html'), injectSupabaseVars(adminStudentsHtml));
const adminCompaniesHtml = `<!DOCTYPE html><html lang="nl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Bedrijven Beheer - Stage Connectie App</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body { font-family: 'Inter', sans-serif; }</style><script>if (!localStorage.getItem('stageconnect_admin_session')) { window.location.href = 'admin-login.html'; }</script></head><body class="bg-gray-50"><header class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><div class="flex items-center gap-4"><a href="admin.html" class="text-gray-500 hover:text-gray-700">‚Üê Terug</a><div><h1 class="text-2xl font-bold text-gray-800">Bedrijven Beheer</h1><p class="text-sm text-gray-600">Beheer stagebedrijven en toegangscodes</p></div></div><button onclick="logout()" class="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition">Uitloggen</button></div></header><main class="max-w-7xl mx-auto px-4 py-8"><div class="mb-6 flex justify-end"><button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>Nieuw Bedrijf</button></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bedrijfsnaam</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contactpersoon</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Toegangscode</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Acties</th></tr></thead><tbody id="companies-table-body" class="divide-y divide-gray-200"></tbody></table></div></main><div id="company-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6"><h2 id="modal-title" class="text-xl font-bold mb-4">Bedrijf Toevoegen</h2><form id="company-form" class="space-y-4"><input type="hidden" id="company-id"><div><label class="block text-sm font-medium text-gray-700 mb-1">Bedrijfsnaam</label><input type="text" id="company_name" required class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Contactpersoon</label><input type="text" id="contact_person" class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="email" class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Adres</label><input type="text" id="address" class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Toegangscode (4 cijfers)</label><input type="text" id="access_code" required maxlength="4" pattern="\\d{4}" class="w-full px-3 py-2 border rounded-lg" placeholder="Bijv. 1234"></div><div class="flex justify-end gap-3 mt-6"><button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Annuleren</button><button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Opslaan</button></div></form></div></div><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script>const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);async function loadData(){const{data:e,error:t}=await supabase.from("Bedrijven").select("*").order("company_name");t&&console.error(t);const n=document.getElementById("companies-table-body");n.innerHTML="",(e||[]).forEach(e=>{n.innerHTML+= \`<tr class="hover:bg-gray-50"><td class="px-6 py-4 text-sm font-medium text-gray-900">\${e.company_name}</td><td class="px-6 py-4 text-sm text-gray-500">\${e.contact_person||"-"}</td><td class="px-6 py-4 text-sm text-gray-500">\${e.email||"-"}</td><td class="px-6 py-4 text-sm font-mono text-gray-500">\${e.access_code||"-"}</td><td class="px-6 py-4 text-right text-sm font-medium"><button onclick='editCompany(\${JSON.stringify(e)})' class="text-blue-600 hover:text-blue-900 mr-3">Bewerk</button><button onclick="deleteCompany('\${e.id}')" class="text-red-600 hover:text-red-900">Verwijder</button></td></tr>\`})}function openModal(e=null){const t=document.getElementById("company-modal"),n=document.getElementById("modal-title"),o=document.getElementById("company-form");t.classList.remove("hidden"),e?(n.textContent="Bedrijf Bewerken",document.getElementById("company-id").value=e.id,document.getElementById("company_name").value=e.company_name,document.getElementById("contact_person").value=e.contact_person||"",document.getElementById("email").value=e.email||"",document.getElementById("address").value=e.address||"",document.getElementById("access_code").value=e.access_code||""):(n.textContent="Bedrijf Toevoegen",o.reset(),document.getElementById("company-id").value="")}function closeModal(){document.getElementById("company-modal").classList.add("hidden")}window.editCompany=function(e){openModal(e)},window.deleteCompany=async function(e){if(confirm("Weet je zeker dat je dit bedrijf wilt verwijderen? Let op: gekoppelde studenten verliezen hun koppeling.")){const{error:t}=await supabase.from("Bedrijven").delete().eq("id",e);t?alert("Fout bij verwijderen: "+t.message):loadData()}},document.getElementById("company-form").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("company-id").value,n={company_name:document.getElementById("company_name").value,contact_person:document.getElementById("contact_person").value||null,email:document.getElementById("email").value||null,address:document.getElementById("address").value||null,access_code:document.getElementById("access_code").value};let o;if(t){const{error:e}=await supabase.from("Bedrijven").update(n).eq("id",t);o=e}else{const{error:e}=await supabase.from("Bedrijven").insert([n]);o=e}o?alert("Fout bij opslaan: "+o.message):(closeModal(),loadData())});function logout(){localStorage.removeItem("stageconnect_admin_session"),window.location.href="admin-login.html"}loadData();</script></body></html>`;
fs.writeFileSync(path.join(buildDir, 'admin-companies.html'), injectSupabaseVars(adminCompaniesHtml));
console.log('‚úÖ HTML bestanden hersteld');
// 2. JS Bestanden
console.log('Herstellen JS bestanden...');
const authV2Js = `const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);async function syncData(e){try{const{data:t,error:a}=await supabase.from("Bedrijven").select("*");if(a)throw a;const s=t.map(e=>({id:e.id,companyName:e.company_name,contactPerson:e.contact_person||"Onbekend",email:e.email,address:e.address||"",accessCode:e.access_code}));localStorage.setItem("sc_employers",JSON.stringify(s));const r=t.find(t=>t.email&&t.email.toLowerCase()===e);r&&localStorage.setItem("sc_selected_employer",r.id);const{data:n,error:o}=await supabase.from("Students").select("*");if(o)throw o;const i=n.map(e=>({id:e.name,name:e.name,studentNumber:e.student_number,companyId:e.company_id,level:e.level,startDate:e.start_date,endDate:e.end_date,scheduledDays:e.scheduled_days||["Ma","Di","Wo","Do","Vr"]}));localStorage.setItem("sc_students",JSON.stringify(i));const c=i.map((e,t)=>({id:\`int_\${Date.now()}_\${t}\`,studentId:e.name,employerId:e.companyId,supervisorId:"sup1",startDate:e.startDate||"2025-02-01",endDate:e.endDate||"2025-07-31",scheduledDays:e.scheduledDays}));localStorage.setItem("sc_internships",JSON.stringify(c))}catch(e){console.error("Fout bij data sync:",e)}}async function saveAttendanceToSupabase(e){try{const{data:t,error:a}=await supabase.from("Attendance").insert([{student_id:e.studentId,employer_id:e.employerId,date:e.date,status:e.status,minutes_late:e.minutesLate||0}]);return a?{success:!1,error:a}:{success:!0,data:t}}catch(e){return{success:!1,error:e}}}window.saveAttendanceToSupabase=saveAttendanceToSupabase;async function ensureTestCompany(){await supabase.from("Bedrijven").upsert({id:"2e34ea56-7700-4db6-a62f-4d6676d0b93e",company_name:"Test Bedrijf",access_code:"9999",email:"test@bedrijf.nl"},{onConflict:"id"})}ensureTestCompany();const loginForm=document.getElementById("login-form"),errorMessage=document.getElementById("error-message");loginForm&&loginForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value,a=document.getElementById("password").value;errorMessage.classList.add("hidden");try{const{data:e,error:s}=await supabase.auth.signInWithPassword({email:t,password:a});if(s)throw s;localStorage.setItem("stageconnect_session","true"),localStorage.setItem("user_email",t),await syncData(t),window.location.href="index.html"}catch(e){errorMessage.textContent="Inloggen mislukt. Controleer je gegevens.",errorMessage.classList.remove("hidden")}});`;
fs.writeFileSync(path.join(staticJs, 'auth_v2.js'), injectSupabaseVars(authV2Js));
const attendanceSyncJs = `window.syncAttendance=async function(e,t,n,a=0){try{const s=JSON.parse(localStorage.getItem("sc_internships")||"[]").find(t=>t.id===e);if(!s)return console.error("Internship niet gevonden:",e),{success:!1,error:"Internship not found"};const r=localStorage.getItem("sc_selected_employer");if(!r)return console.error("Geen werkgever geselecteerd"),{success:!1,error:"No employer selected"};const o={studentId:s.studentId,employerId:r,date:t,status:n,minutesLate:a};if(window.saveAttendanceToSupabase){const e=await window.saveAttendanceToSupabase(o);return e.success?console.log("‚úÖ Aanwezigheid gesynchroniseerd naar Supabase"):console.error("‚ùå Fout bij synchroniseren:",e.error),e}return console.error("saveAttendanceToSupabase functie niet beschikbaar"),{success:!1,error:"Function not available"}}catch(e){return console.error("Crash in syncAttendance:",e),{success:!1,error:e}}};console.log("üì° Attendance sync helper geladen");`;
fs.writeFileSync(path.join(staticJs, 'attendance-sync.js'), injectSupabaseVars(attendanceSyncJs));
const adminAuthJs = `const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);const loginForm=document.getElementById("admin-login-form");loginForm&&loginForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("admin-email").value,n=document.getElementById("admin-password").value,s=document.getElementById("login-error");try{const{data:e,error:a}=await supabase.auth.signInWithPassword({email:t,password:n});if(a)throw a;if(!t.endsWith("@groenehartprocollege.nl"))throw new Error("Alleen school e-mailadressen toegestaan");localStorage.setItem("stageconnect_admin_session","true"),window.location.href="admin.html"}catch(e){s.textContent=e.message,s.classList.remove("hidden")}});function logout(){localStorage.removeItem("stageconnect_admin_session"),window.location.href="admin-login.html"}`;
fs.writeFileSync(path.join(staticJs, 'admin-auth.js'), injectSupabaseVars(adminAuthJs));
const adminJs = `const SUPABASE_URL='https://ninkkvffhvkxrrxddgrz.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbmtrdmZmaHZreHJyeGRkZ3J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc2NTcsImV4cCI6MjA3OTU3MzY1N30.Kq6jojYu5Hopmtzmdqwc9dwUyIZBOm7c27N-OCv1aCM';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);let allAttendance=[],companies=[],students=[];async function init(){await Promise.all([loadCompanies(),loadStudents(),loadAttendance()]),setupRealtimeSubscription(),setupFilters(),updateDashboard()}async function loadCompanies(){const{data:e}=await supabase.from("Bedrijven").select("*");companies=e||[];const t=document.getElementById("filter-company");companies.forEach(e=>{t.innerHTML+= \`<option value="\${e.id}">\${e.company_name}</option>\`})}async function loadStudents(){const{data:e}=await supabase.from("Students").select("*");students=e||[]}async function loadAttendance(){const{data:e,error:t}=await supabase.from("Attendance").select("*").order("date",{ascending:!1});t&&console.error("Error loading attendance:",t),allAttendance=e||[]}function setupRealtimeSubscription(){supabase.channel("public:Attendance").on("postgres_changes",{event:"*",schema:"public",table:"Attendance"},e=>{console.log("Real-time update:",e),loadAttendance().then(updateDashboard)}).subscribe()}function setupFilters(){["filter-date","filter-company","filter-status"].forEach(e=>{document.getElementById(e).addEventListener("change",updateDashboard)}),document.getElementById("filter-date").valueAsDate=new Date}function updateDashboard(){const e=document.getElementById("filter-date").value,t=document.getElementById("filter-company").value,n=document.getElementById("filter-status").value;let s=allAttendance;e&&(s=s.filter(t=>t.date===e)),t&&(s=s.filter(e=>e.employer_id===t)),n&&(s=s.filter(e=>e.status===n)),updateStats(s),renderTable(s)}function updateStats(e){const t={present:e.filter(e=>"present"===e.status).length,absent:e.filter(e=>"absent"===e.status).length,sick:e.filter(e=>"sick"===e.status).length,late:e.filter(e=>"late"===e.status).length};document.getElementById("stat-present").textContent=t.present,document.getElementById("stat-absent").textContent=t.absent,document.getElementById("stat-sick").textContent=t.sick,document.getElementById("stat-late").textContent=t.late}function renderTable(e){const t=document.getElementById("attendance-table-body");t.innerHTML="",e.forEach(e=>{const n=students.find(t=>t.name===e.student_id)||{name:e.student_id},s=companies.find(t=>t.id===e.employer_id)||{company_name:"Onbekend"},a={present:"bg-green-100 text-green-800",absent:"bg-red-100 text-red-800",sick:"bg-orange-100 text-orange-800",late:"bg-yellow-100 text-yellow-800"},o={present:"Aanwezig",absent:"Afwezig",sick:"Ziek",late:\`Te laat (\${e.minutes_late}m)\`},r=\`<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">\${n.name}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">\${s.company_name}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">\${e.date}</td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full \${a[e.status]}">\${o[e.status]}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">\${"late"===e.status?\`\${e.minutes_late} minuten\`:"-"}</td></tr>\`;t.innerHTML+=r})}init();`;
fs.writeFileSync(path.join(staticJs, 'admin.js'), injectSupabaseVars(adminJs));
console.log('‚úÖ JS bestanden hersteld');
// 3. Index.html
console.log('Updaten index.html...');
const indexPath = path.join(buildDir, 'index.html');
let indexHtml = fs.readFileSync(indexPath, 'utf8');
if (!indexHtml.includes('attendance-sync.js')) {
    indexHtml = indexHtml.replace(
        '</body>',
        '<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>\n<script src="./static/js/auth_v2.js"></script>\n<script src="./static/js/attendance-sync.js"></script>\n</body>'
    );
    fs.writeFileSync(indexPath, indexHtml);
    console.log('‚úÖ Scripts toegevoegd aan index.html');
}
console.log('‚úÖ Post-build voltooid!');
